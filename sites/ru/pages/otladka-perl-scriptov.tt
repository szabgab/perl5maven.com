=title Отладка Perl-скриптов
=timestamp 2013-07-10T12:00:00
=indexes -d, Data::Dumper, print, debug, debugging, $VAR1, $VAR2
=status show
=original debugging-perl-scripts
=books beginner_book
=author szabgab
=translator spidamoo
=archive 1
=comments 1
=social 1

=abstract start

Когда я учился информатике в университете, нам много говорили о написании программ, но, насколько я
помню, никто не упоминал об отладке. Мы узнали о прекрасном мире создания нового, но никто не сказал
нам, что бо́льшую часть времени нам придется тратить на то, чтобы понять чужой код.

Оказывается, что, хотя мы придаем больше значения написанию программ, на деле гораздо больше времени
занимают попытки понять, что мы сами (или кто-то другой) написали и почему это работает не так, как 
надо.

=abstract end

<h2>Что такое отладка?</h2>

До запуска программы все было в известном правильном состоянии.

После запуска программы что-то перешло в неожиданное и неправильное состояние.

Задача состоит в том, чтобы выяснить, где что-то пошло не так, и исправить это.

<h2>Что такое программирование и что такое баг?</h2>

По сути, программирование - это небольшое изменение мира посредством изменения данных в переменных.

На каждом этапе программы мы меняем некоторые данные в переменной программы, или что-то в "реальном
мире". (Например, на диске или на экране.)

Когда вы пишете программу, вы продумываете каждый шаг: какое значение в какую переменную должно быть
помещено.

Баг - это случай, когда вы думали, что поместили значение X в какую-то переменную, а на самом деле
туда попало значение Y.

В какой-то момент, обычно в конце программы, вы понимаете это, так как программа выдает неверный
результат.

Во время исполнения программы это может обнаружиться в виде предупреждения или ненормального 
завершения программы.

<h2>Как отлаживать программы?</h2>

Самый прямой путь отладки программы - запустить ее, и на каждом шаге проверять, все ли переменные
содержат предполагаемые значения. Это можно либо сделать <b>с помощью отладчика</b>, либо вставить в
программу выражения <b>print</b> и после ее выполнения проверять вывод.

В Perl входит очень мощный отладчик для командной строки. Мы рекомендуем изучить его, хотя он может
поначалу немного напугать. Я подготовил видео, в котором показываю 
<a href="/ispolzovanie-vstroennogo-otladchika-perl">основные команды встроенного отладчика Perl</a>.

IDE, такие как <a href="http://www.activestate.com/">Komodo</a>, <a href="http://eclipse.org/">Eclipse</a> 
и <a href="http://padre.perlide.org/">Padre, the Perl IDE</a>, включают графические отладчики. 
Когда-нибудь я сделаю видео про какой-нибудь из них.

<h2>Выражения вывода</h2>

Многие люди используют старинную технику добавления в код выражений вывода.

В языках, где компиляция и сборка занимает много времени, использование выражений вывода для
считается плохим способом отладки. Но не в Perl, где даже большие приложения компилируются и 
запускаются в считанные секунды.

Добавляя выражения вывода, нужно позаботиться о помещении разделителей вокруг значений. В таком 
случае вы заметите пробелы в начале и в конце, которые могут вызывать проблемы. Их сложно увидеть 
без разделителей:

Скаларные значения можно выводить так:

<code lang="perl">
print "<$file_name>\n";
</code>

Знаки "меньше" и "больше" здесь нужны только чтобы полностью увидеть содержимое переменной:

<code>
<path/to/file
>
</code>

Если вы увидите подобный вывод, то сразу заметите, что в конце переменной $file_name стоит перевод
строки. Возможно, следовало использовать <b>chomp</b>.

<h2>Сложные структуры данных</h2>

Пока что мы не изучили даже скаляры, но позвольте мне забежать вперед и показать, как можно вывести
содержимое более сложных структур данных. Если вы читаете эту статью как часть учебника Perl,
возможно вам стоит пропустить эту часть и вернуться позже. Пока что она не принесет вам большой пользы.

Если же нет, продолжаем.

Для сложных структур данных (ссылок, массивов и хэшей) можно использовать <hl>Data::Dumper</hl>

<code lang="perl">
use Data::Dumper qw(Dumper);

print Dumper \@an_array;
print Dumper \%a_hash;
print Dumper $a_reference;
</code>

Такой код выведет что-то вроде этого, показав нам содержимое переменных, но их имена будут 
произвольными, вроде <hl>$VAR1</hl> и <hl>$VAR2</hl>.

<code>
$VAR1 = [
       'a',
       'b',
       'c'
     ];
$VAR1 = {
       'a' => 1,
       'b' => 2
     };
$VAR1 = {
       'c' => 3,
       'd' => 4
     };
</code>

Лучше бы доработать немного этот код, чтобы вывести имя переменной:

<code lang="perl">
print '@an_array: ' . Dumper \@an_array;
</code>

получим:

<code>
@an_array: $VAR1 = [
        'a',
        'b',
        'c'
      ];
</code>

либо вызвать Data::Dumper вот так:

<code lang="perl">
print Data::Dumper->Dump([\@an_array, \%a_hash, $a_reference],
   [qw(an_array a_hash a_reference)]);
</code>

получим:

<code>
$an_array = [
            'a',
            'b',
            'c'
          ];
$a_hash = {
          'a' => 1,
          'b' => 2
        };
$a_reference = {
               'c' => 3,
               'd' => 4
             };
</code>

Существуют и лучшие способы вывода структур данных, но пока что <hl>Data::Dumper</hl> нас устраивает,
и он включен в любой установочный пакет Perl. Другие способы мы обсудим позднее.

